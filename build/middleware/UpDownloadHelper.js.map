{"version":3,"sources":["../../server/middleware/UpDownloadHelper.js"],"names":["uploadDir","process","cwd","uploadSingleFile","req","res","next","options","multiples","keepExtensions","maxFileSize","form","files","fields","onPart","part","filename","match","_handlePart","_error","Error","parse","on","fieldName","value","push","once","file","console","log","fileAttrb","uploadMultipleFile","showProductImage","params","url","config","UPLOAD_DIR","fs","createReadStream","responseNotFound","pipe","writeHead","end"],"mappings":"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","sourcesContent":["import formidable from 'formidable';\r\nimport fs from 'fs';\r\nimport config from '../config/config';\r\n\r\nconst uploadDir = process.cwd() + '/storages/';\r\n\r\nconst uploadSingleFile = async (req, res, next) => {\r\n    const options = {\r\n        multiples: false,\r\n        keepExtensions: true,\r\n        uploadDir: uploadDir,\r\n        maxFileSize: 50 * 1024 * 1024, // 5MB\r\n    }\r\n    const form = formidable(options);\r\n    let files = [];\r\n    let fields = [];\r\n\r\n    form.onPart = function (part) {\r\n\r\n        if (!part.filename || part.filename.match(/\\.(jpg|jpeg|png)$/i)) {\r\n            this._handlePart(part);\r\n        }\r\n        else {\r\n            form._error(new Error('File type is not supported'));\r\n        }\r\n    }\r\n\r\n    form.parse(req)\r\n        .on('field', (fieldName, value) => {\r\n            fields.push({ fieldName, value });\r\n        })\r\n        .once('file', (fieldName, file) => {\r\n            files.push({ fieldName, file });\r\n            //files = { ...{ fieldName, file } }\r\n        })\r\n        .once('end', () => {\r\n            console.log('-> upload done');\r\n            req.fileAttrb = ({\r\n                files: files,\r\n                fields: fields\r\n            });\r\n            next();\r\n        });\r\n\r\n\r\n}\r\n\r\nconst uploadMultipleFile = async (req, res, next) => {\r\n    const options = {\r\n        multiples: true,\r\n        keepExtensions: true,\r\n        uploadDir: uploadDir,\r\n        maxFileSize: 50 * 1024 * 1024, // 5MB\r\n    }\r\n    const form = formidable(options);\r\n    let files = [];\r\n    let fields = [];\r\n\r\n    // check tiap attribute\r\n    form.onPart = function (part) {\r\n\r\n        if (!part.filename || part.filename.match(/\\.(jpg|jpeg|png)$/i)) {\r\n            this._handlePart(part);\r\n        }\r\n        else {\r\n            form._error(new Error('File type is not supported'));\r\n        }\r\n    }\r\n\r\n    form.parse(req)\r\n        .on('field', (fieldName, value) => {\r\n            fields.push({ fieldName, value });\r\n        })\r\n        .on('file', (fieldName, file) => {\r\n            files.push({ fieldName, file });\r\n            //files = { ...{ fieldName, file } }\r\n        })\r\n        .once('end', () => {\r\n            console.log('-> upload done');\r\n            req.fileAttrb = ({\r\n                files: files,\r\n                fields: fields\r\n            });\r\n            next();\r\n        });\r\n\r\n\r\n}\r\n\r\nconst showProductImage = async (req, res) => {\r\n    const filename = req.params.filename;\r\n    const url = `${process.cwd()}/${config.UPLOAD_DIR}/${filename}`;\r\n    fs.createReadStream(url)\r\n        .on(\"error\", () => responseNotFound(req, res))\r\n        .pipe(res);\r\n}\r\n\r\n\r\nfunction responseNotFound(req, res) {\r\n    res.writeHead(404, { \"Content-Type\": \"text/plain\" });\r\n    res.end(\"Not Found\")\r\n}\r\n\r\n\r\nexport default {\r\n    uploadSingleFile,\r\n    showProductImage,\r\n    uploadMultipleFile\r\n}\r\n"],"file":"UpDownloadHelper.js"}